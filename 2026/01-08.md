# 2026-01-08
## 今日学んだこと（NAT / NAPT / NAT64・DNS64）※問題演習まとめ

---

## 1) NAT / NAPTとは
- **グローバルIPv4アドレス**：インターネット上で重複しないよう管理されたアドレス  
- **プライベートIPv4アドレス**：社内LANなど閉域ネットワーク内だけで利用するアドレス  
- プライベートIPしか持たないLAN内機器は、そのままではインターネット上の機器と直接通信できない  
  → そこで **NAT** を使って通信できるようにする :contentReference[oaicite:0]{index=0}

この問題で扱うNATは **NAPT（IPアドレス＋ポート番号の変換）** で、
- 送信時：**送信元IP/ポート**を書き換えて外へ出す
- 受信時：**宛先IP/ポート**を書き換えてLAN内の端末へ戻す  
という仕組み :contentReference[oaicite:1]{index=1}

---

## 2) 書き換えの考え方（送信・受信）
### 送信パケット（LAN内 → インターネット）
- 書き換え前：送信元 = **LAN内機器のIP/ポート**
- 書き換え後：送信元 = **ルータのグローバルIP/ルータのポート**

### 受信パケット（インターネット → LAN内）
- 書き換え前：宛先 = **ルータのグローバルIP/ルータのポート**
- 書き換え後：宛先 = **LAN内機器のIP/ポート** :contentReference[oaicite:2]{index=2}

---

## 3) 静的NAT と 動的NAT（違い）
- **静的NAT**：  
  「ルータ側（グローバルIP/ポート）」⇔「LAN内機器（IP/ポート）」の対応を**あらかじめ固定で定義**しておく :contentReference[oaicite:3]{index=3}
- **動的NAT**：  
  通信が発生したときに、空いているグローバルIP/ポートを使って対応付けを作り、一定時間保持して変換する :contentReference[oaicite:4]{index=4}

---

## 4) 【設問1】動的NATが適しているのはどれ？
設問の3ケース :contentReference[oaicite:5]{index=5}
1. インターネット側からアクセス可能なサーバをLAN内に設置  
2. LAN内機器からインターネット機器へアクセス  
3. 異なるLAN同士で、固定ポートを使って相互通信

### ✅結論：**(2)だけ**（解答：エ）
- (1)は外部から“いつでも”到達できるよう **固定の対応（静的NAT/ポート開放）**が必要になりやすい
- (3)は「固定ポートで通信」が前提なので、動的だとポートが変わってしまい不利
- (2)は多数の端末が外へ出る用途で、動的NAT（NAPT）が最も典型 :contentReference[oaicite:6]{index=6}

---

## 5) 【設問2】NAT64 + DNS64（IPv6→IPv4アクセス）
### DNS64の動き（a1〜a3）
- IPv6とIPv4は互換性がないため、IPv6機器→IPv4機器は直接通信できない :contentReference[oaicite:7]{index=7}
- そこで **DNS64** が名前解決時に
  - もし **IPv6アドレス（AAAA）** があればそれを返す
  - なければ **IPv4アドレス（A）** から **IPv6表現（特定プレフィクス＋IPv4）** を合成して返す :contentReference[oaicite:8]{index=8}

✅ a1〜a3 の答え：**エ（a1=IPv6, a2=IPv6, a3=IPv4）** :contentReference[oaicite:9]{index=9}

### NAT64ルータの変換（b〜d）
図の条件（例）：IPv6端末 `fc00::2` が、DNS64で得た宛先 `64:ff9b::c0a8:2`（=IPv4 192.168.0.2のIPv6表現）へHTTP(80)でアクセス :contentReference[oaicite:10]{index=10}

- IPv4へ変換した送信パケットの宛先IP **b**  
  → IPv4サーバ（右側）のIPなので **192.168.0.2**
- IPv4へ変換した送信パケットの送信元IP **c**  
  → NAT64ルータのIPv4側IPなので **192.168.0.1**
- IPv6へ戻した受信パケットの送信元IP **d**  
  → IPv4サーバ(192.168.0.2)のIPv6表現なので **64:ff9b::c0a8:2**

✅ b〜d の答え：  
- **b = 192.168.0.2**  
- **c = 192.168.0.1**  
- **d = 64:ff9b::c0a8:2** :contentReference[oaicite:11]{index=11}

---

## 今日のまとめ
- NAT（NAPT）は **IPアドレス＋ポート**を書き換えて、プライベートIPの端末でもインターネット通信を可能にする :contentReference[oaicite:12]{index=12}
- **静的NAT**は対応が固定で、外部公開サーバなどに向く
- **動的NAT**は通信発生時に対応を作るため、LAN内→外部へのアクセスに向く（設問1は(2)だけ）
- IPv6→IPv4アクセスは **DNS64（名前解決でIPv6表現を合成）＋NAT64（パケット変換）**で実現できる :contentReference[oaicite:13]{index=13}
